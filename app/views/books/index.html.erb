<%= render 'users/userinfo', user: current_user, book_new: @book %>

<div class="col-lg-9">
<h1>Books</h1>

<table class="table table-striped">
  <tr>
    <th>Title</th>
    <th>Opinion</th>
    <th></th>
    <th></th>
    <th></th>
  </tr>
  <% @books.each do |book| %>
  <tr>
    <td><%= link_to user_path(book.user) do %>
      <%= attachment_image_tag book.user, :profile_image, fallback: "no_image.jpg", size: "60x60" %>
      <% end %></td>
    <td><%= link_to book.title, book_path(book.id) %></td>
    <td><%= book.body %></td>
    <td>
      <% if book.favorited_by?(current_user) %>
        <%= link_to book_favorites_path(book), method: :delete do %>
          ♥<%= book.favorites.count %> いいね
        <% end %>
      <% else %>
       <!--ここが初めmethod: :deleteになっていたから、初めからdestroyアクションが呼び起こされて、NoMethodErrorが出ていた-->
        <%= link_to book_favorites_path(book), method: :post do %>
          ♡<%= book.favorites.count %>
        <% end %>
      <% end %>
    </td>
    <td>コメント数：<%= book.book_comments.count %></td>
  </tr>
   <% end %>
   <%= paginate @books %>
</table>

</div>

